{% extends "layout_employees.html" %}

{% block title %}Trang qu·∫£n l√Ω - Storia{% endblock %}

{% block sidebar_menu %}
<nav class="nav flex-column">
    <a class="nav-link active" href="#dashboard" data-bs-toggle="tab"><i class="fas fa-home me-2"></i>Dashboard</a>
    <a class="nav-link" href="#movie-management" data-bs-toggle="tab"><i class="fas fa-film me-2"></i>Qu·∫£n l√Ω phim</a>
    <a class="nav-link" href="#showtime-management" data-bs-toggle="tab"><i class="fas fa-calendar-alt me-2"></i>Qu·∫£n l√Ω su·∫•t chi·∫øu</a>
    <a class="nav-link" href="#revenue-report" data-bs-toggle="tab"><i class="fas fa-chart-line me-2"></i>B√°o c√°o doanh thu</a>
</nav>
{% endblock %}

{% block content %}
<div class="tab-content">
    <!-- Dashboard Tab -->
    <div class="tab-pane fade show active" id="dashboard">
        <h2 class="mb-4">Ch√†o m·ª´ng qu·∫£n l√Ω!</h2>
        <div class="row mb-4" id="dashboard-widgets-row">
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">T·ªïng s·ªë phim</h5>
                        <p class="display-6 mb-0" id="widget-total-movies">...</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">Su·∫•t chi·∫øu h√¥m nay</h5>
                        <p class="display-6 mb-0" id="widget-showtimes-today">...</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">Doanh thu h√¥m nay</h5>
                        <p class="display-6 mb-0 text-success" id="widget-revenue-today">...</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">V√© ƒë√£ b√°n</h5>
                        <p class="display-6 mb-0" id="widget-tickets-sold">...</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-4">
            <div class="col-md-8 mb-3">
                <div class="card h-100">
                    <div class="card-header"><h5 class="mb-0">Doanh thu th√°ng n√†y</h5></div>
                    <div class="card-body">
                        <canvas id="dashboard-revenue-chart" height="120"></canvas>
                        <div class="text-end mt-2">
                            <span class="fw-bold">T·ªïng doanh thu th√°ng: </span>
                            <span id="widget-revenue-month" class="text-success">...</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-header"><h5 class="mb-0">Phim s·∫Øp chi·∫øu</h5></div>
                    <ul class="list-group list-group-flush" id="dashboard-comingsoon-list">
                        <li class="list-group-item text-center text-muted">ƒêang t·∫£i...</li>
                    </ul>
                </div>
            </div>
        </div>
        <p>ƒê√¢y l√† giao di·ªán d√†nh cho qu·∫£n l√Ω r·∫°p phim Storia.</p>
    </div>

    <!-- Movie Management Tab -->
    <div class="tab-pane fade" id="movie-management">
        <h2 class="mb-4">Qu·∫£n l√Ω phim</h2>
        
        <!-- Add Movie Form -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Th√™m phim m·ªõi</h5>
            </div>
            <div class="card-body">
                <form id="addMovieForm" method="POST" action="/manager/add-movie">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="movie_id" class="form-label">ID Phim <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="movie_id" name="movie_id" required 
                                       placeholder="V√≠ d·ª•: movie1, httyd, elio...">
                            </div>
                            
                            <div class="mb-3">
                                <label for="title" class="form-label">T√™n phim <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="title" name="title" required 
                                       placeholder="How to Train Your Dragon">
                            </div>
                            
                            <div class="mb-3">
                                <label for="duration" class="form-label">Th·ªùi l∆∞·ª£ng (ph√∫t) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="duration" name="duration" required 
                                       min="1" placeholder="110">
                            </div>
                            
                            <div class="mb-3">
                                <label for="release_date" class="form-label">Ng√†y kh·ªüi chi·∫øu <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="release_date" name="release_date" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="status" class="form-label">Tr·∫°ng th√°i <span class="text-danger">*</span></label>
                                <select class="form-select" id="status" name="status" required>
                                    <option value="">Ch·ªçn tr·∫°ng th√°i</option>
                                    <option value="Active">ƒêang chi·∫øu</option>
                                    <option value="Coming Soon">S·∫Øp chi·∫øu</option>
                                    <option value="Inactive">Ng·ª´ng chi·∫øu</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="genres" class="form-label">Th·ªÉ lo·∫°i <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="genres" name="genres" required 
                                       placeholder="Animation, Adventure (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y)">
                                <div class="form-text">Nh·∫≠p c√°c th·ªÉ lo·∫°i, ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="thumbnail_url" class="form-label">URL Thumbnail</label>
                                <input type="url" class="form-control" id="thumbnail_url" name="thumbnail_url" 
                                       placeholder="https://example.com/movie-thumbnail.jpg">
                            </div>
                            
                            <div class="mb-3">
                                <label for="poster" class="form-label">ƒê∆∞·ªùng d·∫´n Poster <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="poster" name="poster" required 
                                       placeholder="/static/img/showing_movie1.jpg">
                                <div class="form-text">ƒê∆∞·ªùng d·∫´n t·ªõi file poster trong th∆∞ m·ª•c static</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="description" class="form-label">M√¥ t·∫£ phim <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="description" name="description" rows="4" required 
                                          placeholder="M√¥ t·∫£ n·ªôi dung phim..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-end gap-2">
                        <button type="reset" class="btn btn-secondary">X√≥a form</button>
                        <button type="submit" class="btn btn-primary">Th√™m phim</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Movie List -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Danh s√°ch phim</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>T√™n phim</th>
                                <th>Th·ªÉ lo·∫°i</th>
                                <th>Th·ªùi l∆∞·ª£ng</th>
                                <th>Ng√†y kh·ªüi chi·∫øu</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody id="movieTableBody">
                            <!-- Movies will be loaded here via JavaScript -->
                            <tr>
                                <td colspan="7" class="text-center">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Showtime Management Tab -->
    <div class="tab-pane fade" id="showtime-management">
        <h2 class="mb-4">Qu·∫£n l√Ω su·∫•t chi·∫øu</h2>
        
        <!-- Add Showtime Form (chu·∫©n h√≥a tr∆∞·ªùng d·ªØ li·ªáu, ch·ªâ c√≤n movie_id, cinema, hall, date, time, base_price) -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">T·∫°o su·∫•t chi·∫øu m·ªõi</h5>
            </div>
            <div class="card-body">
                <form id="addShowtimeForm" method="POST">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="showtime_movie_id" class="form-label">Ch·ªçn phim <span class="text-danger">*</span></label>
                                <select class="form-select" id="showtime_movie_id" name="movie_id" required>
                                    <option value="">Ch·ªçn phim...</option>
                                    <!-- JS s·∫Ω load danh s√°ch phim -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="cinema" class="form-label">Ch·ªçn r·∫°p <span class="text-danger">*</span></label>
                                <select class="form-select" id="cinema" name="cinema" required>
                                    <option value="">Ch·ªçn r·∫°p...</option>
                                    <option value="Storia H√† N·ªôi">Storia H√† N·ªôi</option>
                                    <option value="Storia S√†i G√≤n">Storia S√†i G√≤n</option>
                                </select>
                                    </div>
                                </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="hall" class="form-label">Ch·ªçn ph√≤ng <span class="text-danger">*</span></label>
                                <select class="form-select" id="hall" name="hall" required>
                                    <option value="">Ch·ªçn ph√≤ng...</option>
                                    <option value="Hall 1">Hall 1</option>
                                    <option value="Hall 2">Hall 2</option>
                                    <option value="Hall 3">Hall 3</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="date" class="form-label">Ng√†y chi·∫øu <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="date" name="date" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="time" class="form-label">Gi·ªù chi·∫øu <span class="text-danger">*</span></label>
                                <input type="time" class="form-control" id="time" name="time" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="base_price" class="form-label">Gi√° v√© c∆° b·∫£n (VNƒê) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="base_price" name="base_price" required min="50000" step="1000" value="90000">
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                        <button type="reset" class="btn btn-secondary">X√≥a form</button>
                        <button type="submit" class="btn btn-success">T·∫°o su·∫•t chi·∫øu</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Showtime List -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Danh s√°ch su·∫•t chi·∫øu</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Phim</th>
                                <th>R·∫°p</th>
                                <th>Ph√≤ng</th>
                                <th>Ng√†y chi·∫øu</th>
                                <th>Gi·ªù chi·∫øu</th>
                                <th>Gi√° v√©</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody id="showtimeTableBody">
                            <!-- Showtimes will be loaded here via JavaScript -->
                            <tr>
                                <td colspan="8" class="text-center">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Revenue Report Tab -->
    <div class="tab-pane fade" id="revenue-report">
        <h2 class="mb-4">B√ÅO C√ÅO DOANH THU</h2>
        <div class="mb-3">
            <p class="text-muted">Xem th·ªëng k√™ doanh thu. Ch·ªçn ki·ªÉu hi·ªÉn th·ªã ƒë·ªÉ l·ªçc d·ªØ li·ªáu.</p>
            <div class="row mb-3">
              <div class="col-md-4">
                <select id="salesChartType" class="form-select">
                  <option value="byDay">Doanh thu theo ng√†y</option>
                  <option value="byMovie">Doanh thu theo phim</option>
                  <option value="byShowtime">Doanh thu theo su·∫•t chi·∫øu</option>
                  <option value="byHall">Doanh thu theo r·∫°p</option>
                </select>
              </div>
            </div>
        </div>
        <div class="row mb-3" id="cinema-filter-row" style="display:none;">
          <div class="col-md-4">
            <select id="cinemaFilter" class="form-select">
              <option value="All">T·∫•t c·∫£ r·∫°p</option>
              <option value="Storia H√† N·ªôi">H√† N·ªôi</option>
              <option value="Storia S√†i G√≤n">S√†i G√≤n</option>
            </select>
          </div>
        </div>
        <canvas id="salesChart"></canvas>
    </div>

    <!-- Staff Management Tab (X√ìA PH·∫¶N N√ÄY) -->
    <!-- <div class="tab-pane fade" id="staff-management">
        <h2 class="mb-4">Qu·∫£n l√Ω nh√¢n vi√™n</h2>
        <p>T√≠nh nƒÉng qu·∫£n l√Ω nh√¢n vi√™n s·∫Ω ƒë∆∞·ª£c ph√°t tri·ªÉn sau.</p>
    </div> -->
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/manager.js') }}"></script>

<!-- Fix logout button for manager -->
<style>
/* Force logout button to be visible */
.sidebar-logout {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative !important;
    z-index: 1001 !important;
}

.sidebar-logout .btn {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
    cursor: pointer !important;
}

/* Ensure sidebar has proper flex layout */
.sidebar {
    display: flex !important;
    flex-direction: column !important;
    min-height: 100vh !important;
}

.sidebar-menu {
    flex: 1 !important;
    min-height: 0 !important;
}

.sidebar-logout {
    flex-shrink: 0 !important;
    margin-top: auto !important;
}
</style>

<script>
// Only add CSS fix for manager, use layout's handleLogout
document.addEventListener('DOMContentLoaded', function() {
    console.log('üîç Setting up logout button CSS fix in manager.html...');
    
    // Wait a bit for layout to load
    setTimeout(function() {
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            console.log('‚úÖ Logout button found in manager');
            
            // Force button to be visible with CSS
            logoutBtn.style.display = 'block';
            logoutBtn.style.visibility = 'visible';
            logoutBtn.style.opacity = '1';
            logoutBtn.style.pointerEvents = 'auto';
            
            console.log('‚úÖ Logout button CSS fix complete for manager');
            } else {
            console.log('‚ùå Logout button not found in manager');
        }
    }, 1000); // Wait 1 second
});
</script>
{% endblock %} 